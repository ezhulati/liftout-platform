# Nixpacks configuration for Railway deployment
# This file controls how Railway builds the application

[variables]
# Skip browser downloads during install - these are only needed for E2E tests
PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD = "1"
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "1"
PLAYWRIGHT_BROWSERS_PATH = "0"
# Enable CI mode
CI = "true"
# Increase Node memory for Next.js build
NODE_OPTIONS = "--max-old-space-size=4096"

[phases.setup]
nixPkgs = ["nodejs_20", "openssl"]

[phases.install]
cmds = ["corepack enable", "pnpm install --frozen-lockfile"]

[phases.build]
cmds = ["pnpm run build --filter=@liftout/web-app"]

[start]
cmd = "cd apps/web-app && pnpm run start"
